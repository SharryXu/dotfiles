#!/bin/bash

# TODO: Remember to deal with lastest slash character.

# File copy (If the original file is newer than the target file)
# Globals:
#   realpath
#   basename
#   print
#   cp
#   diff
# Arguments:
#   Source File Path
#   Target Folder Path
# Returns:
#   None

function usage() {
  echo "Usage: $(basename $0) source_file target_directory" 1>&2
  exit 1
}

if [ $# -eq 2 ]; then
  sourceFilePath=$(realpath $1)
  targetFolderPath=$(realpath $2)
  filename=$(basename $sourceFilePath)

  if [[ ! -f $sourceFilePath ]]; then
    print 3 "The file: $sourceFilePath is not existed."
    exit 1
  elif [[ -d $sourceFilePath ]]; then
    print 3 "The source file path direct to a folder."
    exit 3
  fi

  if [[ ! -d $targetFolderPath ]]; then
    print 3 "The source folder: $targetFolderPath is illegal."
    exit 2
  fi

  if [[ -f $targetFolderPath/$filename ]]; then
    if diff $sourceFilePath $targetFolderPath/$filename > /dev/null; then
      print 2 "File name $filename don't need to replace."
    else
      cp $sourceFilePath $targetFolderPath
      print 1 "File name $filename is replaced."
    fi
  else
    cp $sourceFilePath $targetFolderPath
    print 1 "File name $filename has been created."
  fi

  exit 0
else
  usage
fi
