#!/bin/bash

# TODO: Add a parameter to let customer choose a specific sync algorithm.

# Sync folder
# Globals:
#   rsync
#   print
# Arguments:
#   Source Folder Path
#   Target Folder Path
# Returns:
#   None

function usage() {
  echo -e "usage: $(basename $0) [options] source_folder_path target_folder_path\n
[options]:
-s  Sudo password
-h  Show help information"

  exit 1
}

sudo_password=''

while getopts "s:h" option; do
  case $option in
    s)sudo_password=${OPTARG};;
    h|*)usage;;
  esac
done

shift $((OPTIND-1))

if [[ $# == 2 && -n $sudo_password ]]; then
  sourceFolderPath=$(realpath $1)
  targetFolderPath=$(realpath $2)

  if [[ ! -d $sourceFolderPath ]]; then
    print 3 "The source folder: $sourceFolderPath is illegal."
    exit 2
  fi

  if [[ ! -d $targetFolderPath ]]; then
    print 3 "The target folder: $targetFolderPath is illegal."
    exit 2
  fi

  echo $sudo_password | sudo -S rsync -avz --delete $sourceFolderPath/ $targetFolderPath

  exit $?
else
  usage
fi
